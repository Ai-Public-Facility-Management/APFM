# ========== ë¹Œë“œ ë‹¨ê³„ ==========
FROM maven:3.9.9-eclipse-temurin-17 AS builder
WORKDIR /app

# Maven ìºì‹œ ìµœì í™”
COPY pom.xml .
RUN mvn dependency:go-offline -B

# ì‹¤ì œ ì†ŒìŠ¤ ë³µì‚¬ í›„ ë¹Œë“œ
COPY src ./src
RUN mvn clean package -DskipTests

# ========== ì‹¤í–‰ ë‹¨ê³„ ==========
FROM eclipse-temurin:17-jdk-jammy
WORKDIR /app

# ë¹Œë“œ ê²°ê³¼ë¬¼ ë³µì‚¬
COPY --from=builder /app/target/*-SNAPSHOT.jar app.jar

# íƒ€ì„ì¡´ ì„¤ì •
ENV TZ=Asia/Seoul
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# ê¸°ë³¸ê°’: docker í”„ë¡œíŒŒì¼
# ğŸš¨ í•„ìš”í•  ë•Œ CI/CDë‚˜ docker-compose, k8sì—ì„œ SPRING_PROFILES_ACTIVE=prod ë¡œ ì˜¤ë²„ë¼ì´ë“œ ê°€ëŠ¥
ENV SPRING_PROFILES_ACTIVE=docker

EXPOSE 8082

ENTRYPOINT ["java", "-Xmx400M", "-Djava.security.egd=file:/dev/./urandom", "-jar", "/app/app.jar"]
